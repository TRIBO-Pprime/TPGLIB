<!-- -*- mode: jinja2 -*- -->

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta name="description" content="TPGLIB – Tools for surface analyses">
    <meta name="author" content="Arthur Francisco" >
    <link rel="icon" href="../favicon.png">

    <title>abbott_param &ndash; TPGLIB</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link href="../css/pygments.css" rel="stylesheet">
    <link href="../css/font-awesome.min.css" rel="stylesheet">
    <link href="../css/local.css" rel="stylesheet">
      <link  href="../tipuesearch/tipuesearch.css" rel="stylesheet">
      <link href="../css/user.css" rel="stylesheet">

    <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
    <script src="../js/svg-pan-zoom.min.js"></script>
  </head>

  <body>

    <!-- Fixed navbar -->
    <div class="container-fluid mb-sm-4 mb-xl-2">
      <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
        <div class="container">
          <a class="navbar-brand" href="../index.html">TPGLIB </a>
          <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar"
                  aria-expanded="false" aria-controls="navbar" aria-label="Toggle navigation">
                  <span class="navbar-toggler-icon">
          </button>

          <div id="navbar" class="navbar-collapse collapse">
            <ul class="navbar-nav">
                  <li class="nav-item">
                    <a class="nav-link" href="../lists/files.html">Source Files</a>
                  </li>
                <li class="nav-item">
                  <a class="nav-link" href="../lists/modules.html">Modules</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="../lists/procedures.html">Procedures</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="../lists/types.html">Derived Types</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="../lists/programs.html">Programs</a>
                </li>
            </ul>
              <div class="d-flex align-items-end flex-grow-1">
                <form action="../search.html" role="search" class="ms-auto">
                  <input type="text" class="form-control" aria-label="Search" placeholder="Search" name="q" id="tipue_search_input" autocomplete="off" required>
                </form>
              </div>
          </div><!--/.nav-collapse -->
        </div>
      </nav>
    </div>

    <div class="container">
  <div class="row">
    <h1>abbott_param
      <small>Subroutine</small>
      
    </h1>
      <div class="container p-2 mb-4 bg-light border rounded-3">
    <div class="row align-items-center justify-content-between" id="info-bar">
      <div class="col">
        <ul class="list-inline" style="margin-bottom:0px;display:inline">

            <li class="list-inline-item" id="statements"><i class="fa fa-list-ol"></i>
              <a data-bs-toggle="tooltip" data-bs-placement="bottom" data-bs-html="true"
                 title=" 5.0% of total for procedures.">174 statements</a>
            </li>

            <li class="list-inline-item" id="source-file">
              <i class="fa fa-code"></i>
              <a href="../src/mod_abbott.f90"> Source File</a>
            </li>
        </ul>
      </div>
      <div class="col">
        <nav aria-label="breadcrumb">
          <ol class="breadcrumb justify-content-end mb-0">
                <li class="breadcrumb-item"><a href='../sourcefile/mod_abbott.f90.html'>mod_abbott.f90</a></li>
                <li class="breadcrumb-item"><a href='../module/abbott.html'>abbott</a></li>
            <li class="breadcrumb-item active" aria-current="page">abbott_param</li>
          </ol>
        </nav>
      </div>
    </div>
  </div>
  <script>
    $(function () {
    $('[data-bs-toggle="tooltip"]').tooltip()
    })
  </script>

  </div>
  
  <div class="row">
    <div class="col-md-3 hidden-xs hidden-sm visible-md visible-lg">
      <div id="sidebar">
      <h3>Contents</h3>
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
    <div class="card card-primary">
      <div class="card-header text-left"><h3 class="card-title">Source Code</h3></div>
      <div class="list-group">
        <a class="list-group-item" href="../proc/abbott_param.html#src">abbott_param</a>
      </div>
    </div>


  </div>

    </div>
    
    <div class="col-md-9" id='text'>
    <h2>public  subroutine abbott_param(tab, lg, nom, curves, results, omp)  
</h2>
    

    <div class="alert alert-info">
<p class="alert-title h4">Note</p>
<p>Function that returns the Abbott&rsquo;s curve in a svg file as well as smrk1, smrk2, spk, svk, sk</p>
</div>


    <h3>Arguments</h3>
        <table class="table table-striped varlist">
    <thead>
      <tr>
        <th scope="col">Type</th>
<th scope="col">Intent</th><th scope="col">Optional</th>        <th scope="col">Attributes</th>
        <th scope="col"></th>
        <th scope="col">Name</th>
        <th scope="col"></th>
    </thead>
    <tbody>
        <tr>
            <td>
              <span class="anchor" id="variable-tab"></span>
              real(kind=R8),
            </td>
<td>intent(inout),</td>
              <td></td>            <td>
              dimension(1:lg )
            </td>
            <td>::</td>
            <td><strong>tab</strong></td>
            <td>
                <p><em>surface in a 1D vector</em></p>
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-lg"></span>
              integer(kind=I4),
            </td>
<td>intent(in)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>lg</strong></td>
            <td>
                <p><em>surface total number of points</em></p>
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-nom"></span>
              character(len=*),
            </td>
<td>intent(in)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>nom</strong></td>
            <td>
                <p><em>output generic name</em></p>
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-curves"></span>
              logical(kind=I4),
            </td>
<td>intent(in),</td>
              <td></td>            <td>
              dimension(1:3)
            </td>
            <td>::</td>
            <td><strong>curves</strong></td>
            <td>
                <p><em>if true, generates a svg drawing</em>
1: histogram 2: Abbott 3: tangent fit</p>
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-results"></span>
              real(kind=R8),
            </td>
<td>intent(out),</td>
              <td></td>            <td>
              dimension(1:11 )
            </td>
            <td>::</td>
            <td><strong>results</strong></td>
            <td>
                <p><em>surface parameters output</em></p>
<ul>
<li>1 <strong>smrk1</strong>, iso 25178</li>
<li>2 <strong>smrk2</strong>, iso 25178</li>
<li>3 <strong>spk</strong>  , iso 25178</li>
<li>4 <strong>svk</strong>  , iso 25178</li>
<li>5 <strong>off1</strong> , ordonnée de spk</li>
<li>6 <strong>off2</strong> , ordonnée de svk</li>
<li>7 <strong>sk</strong>   , iso 25178</li>
<li>8 <strong>core slope</strong></li>
<li>9 <strong>adjustment factor</strong> (tangent fit)</li>
<li>10 <strong>coeffa_tan</strong>        (tangent fit)</li>
<li>11 <strong>coeffb_tan</strong>        (tangent fit)</li>
</ul>
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-omp"></span>
              logical(kind=I4),
            </td>
<td>intent(in)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>omp</strong></td>
            <td>
                <p><em>if true, openmp used</em></p>
            </td>
        </tr>
    </tbody>
  </table>

    <br>
    <div class="card">
      <div class="card-header">
  <h3 class="card-title">Calls</h3>
      </div>
      <div class="card-body">
  <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: proc~~abbott_param~~CallsGraph Pages: 1 -->
<svg id="procabbott_paramCallsGraph" width="393pt" height="284pt"
 viewBox="0.00 0.00 393.00 284.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="proc~~abbott_param~~CallsGraph" class="graph" transform="scale(1 1) rotate(0) translate(4 280)">
<title>proc~~abbott_param~~CallsGraph</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-280 389,-280 389,4 -4,4"/>
<!-- proc~abbott_param -->
<g id="proc~~abbott_param~~CallsGraph_node1" class="node">
<title>proc~abbott_param</title>
<polygon fill="none" stroke="black" points="79,-150 0,-150 0,-126 79,-126 79,-150"/>
<text text-anchor="middle" x="39.5" y="-135.6" font-family="Helvetica,sans-Serif" font-size="10.50">abbott_param</text>
</g>
<!-- get_unit -->
<g id="proc~~abbott_param~~CallsGraph_node2" class="node">
<title>get_unit</title>
<polygon fill="#777777" stroke="#777777" points="208.5,-276 154.5,-276 154.5,-252 208.5,-252 208.5,-276"/>
<text text-anchor="middle" x="181.5" y="-261.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">get_unit</text>
</g>
<!-- proc~abbott_param&#45;&gt;get_unit -->
<g id="proc~~abbott_param~~CallsGraph_edge1" class="edge">
<title>proc~abbott_param&#45;&gt;get_unit</title>
<path fill="none" stroke="#ff0000" d="M45.97,-150.34C56.29,-172.23 80.73,-217.91 115,-243 123.67,-249.35 134.34,-253.83 144.53,-256.97"/>
<polygon fill="#ff0000" stroke="#ff0000" points="143.9,-260.43 154.47,-259.68 145.75,-253.67 143.9,-260.43"/>
</g>
<!-- init -->
<g id="proc~~abbott_param~~CallsGraph_node3" class="node">
<title>init</title>
<polygon fill="#777777" stroke="#777777" points="208.5,-234 154.5,-234 154.5,-210 208.5,-210 208.5,-234"/>
<text text-anchor="middle" x="181.5" y="-219.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">init</text>
</g>
<!-- proc~abbott_param&#45;&gt;init -->
<g id="proc~~abbott_param~~CallsGraph_edge2" class="edge">
<title>proc~abbott_param&#45;&gt;init</title>
<path fill="none" stroke="#ff0000" d="M52.03,-150.32C65.8,-164.38 90.11,-187.2 115,-201 124.17,-206.08 134.74,-210.14 144.69,-213.29"/>
<polygon fill="#ff0000" stroke="#ff0000" points="143.77,-216.67 154.35,-216.14 145.74,-209.96 143.77,-216.67"/>
</g>
<!-- moindres_carres_lineaire -->
<g id="proc~~abbott_param~~CallsGraph_node4" class="node">
<title>moindres_carres_lineaire</title>
<polygon fill="#777777" stroke="#777777" points="248,-192 115,-192 115,-168 248,-168 248,-192"/>
<text text-anchor="middle" x="181.5" y="-177.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">moindres_carres_lineaire</text>
</g>
<!-- proc~abbott_param&#45;&gt;moindres_carres_lineaire -->
<g id="proc~~abbott_param~~CallsGraph_edge3" class="edge">
<title>proc~abbott_param&#45;&gt;moindres_carres_lineaire</title>
<path fill="none" stroke="#ff0000" d="M79.13,-149.59C94.96,-154.34 113.49,-159.9 130.35,-164.95"/>
<polygon fill="#ff0000" stroke="#ff0000" points="129.46,-168.34 140.05,-167.86 131.47,-161.64 129.46,-168.34"/>
</g>
<!-- proc~calc_moments -->
<g id="proc~~abbott_param~~CallsGraph_node5" class="node">
<title>proc~calc_moments</title>
<g id="a_proc~~abbott_param~~CallsGraph_node5"><a xlink:href="../proc/calc_moments.html" xlink:title="calc_moments">
<polygon fill="#d9534f" stroke="#d9534f" points="222.5,-150 140.5,-150 140.5,-126 222.5,-126 222.5,-150"/>
<text text-anchor="middle" x="181.5" y="-135.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">calc_moments</text>
</a>
</g>
</g>
<!-- proc~abbott_param&#45;&gt;proc~calc_moments -->
<g id="proc~~abbott_param~~CallsGraph_edge4" class="edge">
<title>proc~abbott_param&#45;&gt;proc~calc_moments</title>
<path fill="none" stroke="#ff0000" d="M79.13,-138C94.81,-138 113.14,-138 129.87,-138"/>
<polygon fill="#ff0000" stroke="#ff0000" points="130.05,-141.5 140.05,-138 130.05,-134.5 130.05,-141.5"/>
</g>
<!-- run_gnuplot -->
<g id="proc~~abbott_param~~CallsGraph_node6" class="node">
<title>run_gnuplot</title>
<polygon fill="#777777" stroke="#777777" points="216.5,-108 146.5,-108 146.5,-84 216.5,-84 216.5,-108"/>
<text text-anchor="middle" x="181.5" y="-93.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">run_gnuplot</text>
</g>
<!-- proc~abbott_param&#45;&gt;run_gnuplot -->
<g id="proc~~abbott_param~~CallsGraph_edge5" class="edge">
<title>proc~abbott_param&#45;&gt;run_gnuplot</title>
<path fill="none" stroke="#ff0000" d="M79.13,-126.41C96.96,-121.06 118.23,-114.68 136.66,-109.15"/>
<polygon fill="#ff0000" stroke="#ff0000" points="137.72,-112.49 146.29,-106.26 135.71,-105.78 137.72,-112.49"/>
</g>
<!-- solve -->
<g id="proc~~abbott_param~~CallsGraph_node7" class="node">
<title>solve</title>
<polygon fill="#777777" stroke="#777777" points="208.5,-66 154.5,-66 154.5,-42 208.5,-42 208.5,-66"/>
<text text-anchor="middle" x="181.5" y="-51.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">solve</text>
</g>
<!-- proc~abbott_param&#45;&gt;solve -->
<g id="proc~~abbott_param~~CallsGraph_edge6" class="edge">
<title>proc~abbott_param&#45;&gt;solve</title>
<path fill="none" stroke="#ff0000" d="M52.03,-125.68C65.8,-111.62 90.11,-88.8 115,-75 124.17,-69.92 134.74,-65.86 144.69,-62.71"/>
<polygon fill="#ff0000" stroke="#ff0000" points="145.74,-66.04 154.35,-59.86 143.77,-59.33 145.74,-66.04"/>
</g>
<!-- sort_array2 -->
<g id="proc~~abbott_param~~CallsGraph_node8" class="node">
<title>sort_array2</title>
<polygon fill="#777777" stroke="#777777" points="215,-24 148,-24 148,0 215,0 215,-24"/>
<text text-anchor="middle" x="181.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">sort_array2</text>
</g>
<!-- proc~abbott_param&#45;&gt;sort_array2 -->
<g id="proc~~abbott_param~~CallsGraph_edge7" class="edge">
<title>proc~abbott_param&#45;&gt;sort_array2</title>
<path fill="none" stroke="#ff0000" d="M45.97,-125.66C56.29,-103.77 80.73,-58.09 115,-33 121.93,-27.93 130.13,-24.05 138.34,-21.09"/>
<polygon fill="#ff0000" stroke="#ff0000" points="139.45,-24.41 147.91,-18.03 137.32,-17.75 139.45,-24.41"/>
</g>
<!-- proc~calc_moments_1d -->
<g id="proc~~abbott_param~~CallsGraph_node9" class="node">
<title>proc~calc_moments_1d</title>
<g id="a_proc~~abbott_param~~CallsGraph_node9"><a xlink:href="../proc/calc_moments_1d.html" xlink:title="calc_moments_1D">
<polygon fill="#d9534f" stroke="#d9534f" points="385,-150 284,-150 284,-126 385,-126 385,-150"/>
<text text-anchor="middle" x="334.5" y="-135.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">calc_moments_1D</text>
</a>
</g>
</g>
<!-- proc~calc_moments&#45;&gt;proc~calc_moments_1d -->
<g id="proc~~abbott_param~~CallsGraph_edge8" class="edge">
<title>proc~calc_moments&#45;&gt;proc~calc_moments_1d</title>
<path fill="none" stroke="#00ff91" d="M222.57,-138C238.13,-138 256.28,-138 273.34,-138"/>
<polygon fill="#00ff91" stroke="#00ff91" points="273.79,-141.5 283.79,-138 273.79,-134.5 273.79,-141.5"/>
</g>
</g>
</svg>
</div>          <div>
            <a type="button" class="graph-help" data-bs-toggle="modal" href="#CallsGraph-help-text">Help</a>
          </div>
          <div class="modal fade" id="CallsGraph-help-text" tabindex="-1" role="dialog">
            <div class="modal-dialog modal-lg" role="document">
              <div class="modal-content">
                <div class="modal-header">
                  <h4 class="modal-title" id="-graph-help-label">Graph Key</h4>
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
<p>Nodes of different colours represent the following: </p>
<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="641pt" height="29pt"
 viewBox="0.00 0.00 641.00 29.32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(0.92 0.92) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-28 695.5,-28 695.5,4 -4,4"/>
<!-- Subroutine -->
<g id="node1" class="node">
<title>Subroutine</title>
<polygon fill="#d9534f" stroke="#d9534f" points="64,-24 0,-24 0,0 64,0 64,-24"/>
<text text-anchor="middle" x="32" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Subroutine</text>
</g>
<!-- Function -->
<g id="node2" class="node">
<title>Function</title>
<polygon fill="#d94e8f" stroke="#d94e8f" points="136,-24 82,-24 82,0 136,0 136,-24"/>
<text text-anchor="middle" x="109" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Function</text>
</g>
<!-- Interface -->
<g id="node3" class="node">
<title>Interface</title>
<polygon fill="#a7506f" stroke="#a7506f" points="209.5,-24 154.5,-24 154.5,0 209.5,0 209.5,-24"/>
<text text-anchor="middle" x="182" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Interface</text>
</g>
<!-- Type Bound Procedure -->
<g id="node4" class="node">
<title>Type Bound Procedure</title>
<polygon fill="#a7506f" stroke="#a7506f" points="350,-24 228,-24 228,0 350,0 350,-24"/>
<text text-anchor="middle" x="289" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Type Bound Procedure</text>
</g>
<!-- Unknown Procedure Type -->
<g id="node5" class="node">
<title>Unknown Procedure Type</title>
<polygon fill="#777777" stroke="#777777" points="504,-24 368,-24 368,0 504,0 504,-24"/>
<text text-anchor="middle" x="436" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Unknown Procedure Type</text>
</g>
<!-- Program -->
<g id="node6" class="node">
<title>Program</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="576,-24 522,-24 522,0 576,0 576,-24"/>
<text text-anchor="middle" x="549" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Program</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node7" class="node">
<title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="black" points="691.5,-24 594.5,-24 594.5,0 691.5,0 691.5,-24"/>
<text text-anchor="middle" x="643" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50">This Page&#39;s Entity</text>
</g>
</g>
</svg>

<p>Solid arrows point from a procedure to one which it calls. Dashed 
arrows point from an interface to procedures which implement that interface.
This could include the module procedures in a generic interface or the
implementation in a submodule of an interface in a parent module.
</p>
 Where possible, edges connecting nodes are
given different colours to make them easier to distinguish in
large graphs.</div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="card">
      <div class="card-header">
  <h3 class="card-title">Called by</h3>
      </div>
      <div class="card-body">
  <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: proc~~abbott_param~~CalledByGraph Pages: 1 -->
<svg id="procabbott_paramCalledByGraph" width="189pt" height="32pt"
 viewBox="0.00 0.00 189.00 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="proc~~abbott_param~~CalledByGraph" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>proc~~abbott_param~~CalledByGraph</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-28 185,-28 185,4 -4,4"/>
<!-- proc~abbott_param -->
<g id="proc~~abbott_param~~CalledByGraph_node1" class="node">
<title>proc~abbott_param</title>
<polygon fill="none" stroke="black" points="181,-24 102,-24 102,0 181,0 181,-24"/>
<text text-anchor="middle" x="141.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50">abbott_param</text>
</g>
<!-- program~test_abbott -->
<g id="proc~~abbott_param~~CalledByGraph_node2" class="node">
<title>program~test_abbott</title>
<g id="a_proc~~abbott_param~~CalledByGraph_node2"><a xlink:href="../program/test_abbott.html" xlink:title="test_abbott">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="66,-24 0,-24 0,0 66,0 66,-24"/>
<text text-anchor="middle" x="33" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">test_abbott</text>
</a>
</g>
</g>
<!-- program~test_abbott&#45;&gt;proc~abbott_param -->
<g id="proc~~abbott_param~~CalledByGraph_edge1" class="edge">
<title>program~test_abbott&#45;&gt;proc~abbott_param</title>
<path fill="none" stroke="#ff0000" d="M66.24,-12C74.34,-12 83.21,-12 91.91,-12"/>
<polygon fill="#ff0000" stroke="#ff0000" points="91.99,-15.5 101.99,-12 91.99,-8.5 91.99,-15.5"/>
</g>
</g>
</svg>
</div>          <div>
            <a type="button" class="graph-help" data-bs-toggle="modal" href="#CalledByGraph-help-text">Help</a>
          </div>
          <div class="modal fade" id="CalledByGraph-help-text" tabindex="-1" role="dialog">
            <div class="modal-dialog modal-lg" role="document">
              <div class="modal-content">
                <div class="modal-header">
                  <h4 class="modal-title" id="-graph-help-label">Graph Key</h4>
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
<p>Nodes of different colours represent the following: </p>
<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="641pt" height="29pt"
 viewBox="0.00 0.00 641.00 29.32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(0.92 0.92) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-28 695.5,-28 695.5,4 -4,4"/>
<!-- Subroutine -->
<g id="node1" class="node">
<title>Subroutine</title>
<polygon fill="#d9534f" stroke="#d9534f" points="64,-24 0,-24 0,0 64,0 64,-24"/>
<text text-anchor="middle" x="32" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Subroutine</text>
</g>
<!-- Function -->
<g id="node2" class="node">
<title>Function</title>
<polygon fill="#d94e8f" stroke="#d94e8f" points="136,-24 82,-24 82,0 136,0 136,-24"/>
<text text-anchor="middle" x="109" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Function</text>
</g>
<!-- Interface -->
<g id="node3" class="node">
<title>Interface</title>
<polygon fill="#a7506f" stroke="#a7506f" points="209.5,-24 154.5,-24 154.5,0 209.5,0 209.5,-24"/>
<text text-anchor="middle" x="182" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Interface</text>
</g>
<!-- Type Bound Procedure -->
<g id="node4" class="node">
<title>Type Bound Procedure</title>
<polygon fill="#a7506f" stroke="#a7506f" points="350,-24 228,-24 228,0 350,0 350,-24"/>
<text text-anchor="middle" x="289" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Type Bound Procedure</text>
</g>
<!-- Unknown Procedure Type -->
<g id="node5" class="node">
<title>Unknown Procedure Type</title>
<polygon fill="#777777" stroke="#777777" points="504,-24 368,-24 368,0 504,0 504,-24"/>
<text text-anchor="middle" x="436" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Unknown Procedure Type</text>
</g>
<!-- Program -->
<g id="node6" class="node">
<title>Program</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="576,-24 522,-24 522,0 576,0 576,-24"/>
<text text-anchor="middle" x="549" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Program</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node7" class="node">
<title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="black" points="691.5,-24 594.5,-24 594.5,0 691.5,0 691.5,-24"/>
<text text-anchor="middle" x="643" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50">This Page&#39;s Entity</text>
</g>
</g>
</svg>

<p>Solid arrows point from a procedure to one which it calls. Dashed 
arrows point from an interface to procedures which implement that interface.
This could include the module procedures in a generic interface or the
implementation in a submodule of an interface in a parent module.
</p>
 Where possible, edges connecting nodes are
given different colours to make them easier to distinguish in
large graphs.</div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <br>


    
    

    
    



    
    <section>
    <h2><span class="anchor" id="src"></span>Source Code</h2>
    <div class="hl codehilite"><pre><span></span><span class="w">   </span><span class="k">subroutine </span><span class="n">abbott_param</span><span class="p">(</span><span class="n">tab</span><span class="p">,</span><span class="w"> </span><span class="n">lg</span><span class="p">,</span><span class="w"> </span><span class="n">nom</span><span class="p">,</span><span class="w"> </span><span class="n">curves</span><span class="p">,</span><span class="w"> </span><span class="n">results</span><span class="p">,</span><span class="w"> </span><span class="n">omp</span><span class="p">)</span>
<span class="w">   </span><span class="c">!================================================================================================</span>
<span class="w">   </span><span class="c">!&lt; @note Function that returns the Abbott&#39;s curve in a svg file as well as smrk1, smrk2, spk, svk, sk</span>
<span class="w">   </span><span class="c">!</span>
<span class="w">   </span><span class="c">!  @endnote</span>
<span class="w">   </span><span class="c">!------------------------------------------------------------------------------------------------</span>
<span class="w">   </span><span class="k">implicit none</span>
<span class="k">   </span><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="w">   </span><span class="p">)</span><span class="w">                              </span><span class="kd">::</span><span class="w"> </span><span class="n">lg</span><span class="w">       </span><span class="c">!! *surface total number of points*</span>
<span class="w">   </span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="w">   </span><span class="p">)</span><span class="w">                              </span><span class="kd">::</span><span class="w"> </span><span class="n">nom</span><span class="w">      </span><span class="c">!! *output generic name*</span>
<span class="w">   </span><span class="kt">logical</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="w">   </span><span class="p">),</span><span class="w"> </span><span class="k">dimension</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span><span class="w">              </span><span class="kd">::</span><span class="w"> </span><span class="n">curves</span><span class="w">   </span><span class="c">!! *if true, generates a svg drawing*</span>
<span class="w">                                                                            </span><span class="c">!! 1: histogram 2: Abbott 3: tangent fit</span>
<span class="w">   </span><span class="kt">real</span><span class="w">   </span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">),</span><span class="w"> </span><span class="k">dimension</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">lg</span><span class="w"> </span><span class="p">)</span><span class="w">            </span><span class="kd">::</span><span class="w"> </span><span class="n">tab</span><span class="w">      </span><span class="c">!! *surface in a 1D vector*</span>
<span class="w">   </span><span class="kt">real</span><span class="w">   </span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="w">  </span><span class="n">out</span><span class="p">),</span><span class="w"> </span><span class="k">dimension</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">11</span><span class="w"> </span><span class="p">)</span><span class="w">            </span><span class="kd">::</span><span class="w"> </span><span class="n">results</span><span class="w">  </span><span class="c">!! *surface parameters output*</span>
<span class="w">                                                                            </span><span class="c">!!</span>
<span class="w">                                                                            </span><span class="c">!!  +  1 **smrk1**, iso 25178</span>
<span class="w">                                                                            </span><span class="c">!!  +  2 **smrk2**, iso 25178</span>
<span class="w">                                                                            </span><span class="c">!!  +  3 **spk**  , iso 25178</span>
<span class="w">                                                                            </span><span class="c">!!  +  4 **svk**  , iso 25178</span>
<span class="w">                                                                            </span><span class="c">!!  +  5 **off1** , ordonnée de spk</span>
<span class="w">                                                                            </span><span class="c">!!  +  6 **off2** , ordonnée de svk</span>
<span class="w">                                                                            </span><span class="c">!!  +  7 **sk**   , iso 25178</span>
<span class="w">                                                                            </span><span class="c">!!  +  8 **core slope**</span>
<span class="w">                                                                            </span><span class="c">!!  +  9 **adjustment factor** (tangent fit)</span>
<span class="w">                                                                            </span><span class="c">!!  + 10 **coeffa_tan**        (tangent fit)</span>
<span class="w">                                                                            </span><span class="c">!!  + 11 **coeffb_tan**        (tangent fit)</span>
<span class="w">   </span><span class="kt">logical</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="w">   </span><span class="p">)</span><span class="w">                              </span><span class="kd">::</span><span class="w"> </span><span class="n">omp</span><span class="w">      </span><span class="c">!! *if true, openmp used*</span>

<span class="w">      </span><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">),</span><span class="w"> </span><span class="k">parameter</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">nb_points</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">4096</span><span class="w">   </span><span class="c">! nb points kept for the curve</span>

<span class="w">      </span><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">ua</span><span class="p">,</span><span class="w"> </span><span class="n">icat</span><span class="p">,</span><span class="w"> </span><span class="n">ncat</span><span class="p">,</span><span class="w"> </span><span class="n">nb_paquets</span><span class="p">,</span><span class="w"> </span><span class="n">inc</span><span class="p">,</span><span class="w"> </span><span class="n">reste</span>
<span class="w">      </span><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">len_reg</span><span class="p">,</span><span class="w"> </span><span class="n">beg_reg</span><span class="p">,</span><span class="w"> </span><span class="n">end_reg</span>
<span class="w">      </span><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">smrk1</span><span class="p">,</span><span class="w"> </span><span class="n">smrk2</span><span class="p">,</span><span class="w"> </span><span class="n">ios</span>
<span class="w">      </span><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">status</span><span class="w">                            </span><span class="c">! PIKAIA: status</span>

<span class="w">      </span><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">hmin</span><span class="p">,</span><span class="w"> </span><span class="n">hmax</span><span class="p">,</span><span class="w"> </span><span class="n">delt</span><span class="p">,</span><span class="w"> </span><span class="n">seuil</span><span class="p">,</span><span class="w"> </span><span class="n">reduction</span>
<span class="w">      </span><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">tmp</span><span class="p">,</span><span class="w"> </span><span class="n">off1</span><span class="p">,</span><span class="w"> </span><span class="n">off2</span><span class="p">,</span><span class="w"> </span><span class="n">spk</span><span class="p">,</span><span class="w"> </span><span class="n">svk</span><span class="p">,</span><span class="w"> </span><span class="n">sk</span>
<span class="w">      </span><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">f</span><span class="w">                                    </span><span class="c">! PIKAIA: best cost</span>

<span class="w">      </span><span class="k">type</span><span class="p">(</span><span class="n">moment_stat</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">mx</span>

<span class="w">      </span><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">),</span><span class="w"> </span><span class="k">dimension</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">vec_reg</span>

<span class="w">      </span><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">),</span><span class="w"> </span><span class="k">dimension</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">xx</span><span class="w">                   </span><span class="c">! PIKAIA: chromosom</span>
<span class="w">      </span><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">),</span><span class="w"> </span><span class="k">dimension</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">xl</span><span class="p">,</span><span class="w"> </span><span class="n">xu</span><span class="w">               </span><span class="c">! PIKAIA: lower and upper bonds of xx</span>

<span class="w">      </span><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">),</span><span class="w"> </span><span class="k">allocatable</span><span class="p">,</span><span class="w"> </span><span class="k">dimension</span><span class="p">(:)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">tab_abbott</span>

<span class="w">      </span><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">),</span><span class="w"> </span><span class="k">allocatable</span><span class="p">,</span><span class="w"> </span><span class="k">dimension</span><span class="p">(:)</span><span class="w">   </span><span class="kd">::</span><span class="w"> </span><span class="n">tab_moy</span>
<span class="w">      </span><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">),</span><span class="w"> </span><span class="k">allocatable</span><span class="p">,</span><span class="w"> </span><span class="k">dimension</span><span class="p">(:,:)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">jac_reg</span>

<span class="w">      </span><span class="k">type</span><span class="p">(</span><span class="n">pikaia_class</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">p</span><span class="w">                               </span><span class="c">! PIKAIA: class instanciation</span>


<span class="w">      </span><span class="c">! center heights</span>
<span class="w">      </span><span class="k">call </span><span class="n">calc_moments</span><span class="p">(</span><span class="w">   </span><span class="n">tab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tab</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">lg</span><span class="p">),</span><span class="w">  </span><span class="p">&amp;</span><span class="w">  </span><span class="c">!</span>
<span class="w">                            </span><span class="n">mx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mx</span><span class="p">,</span><span class="w">         </span><span class="p">&amp;</span><span class="w">  </span><span class="c">!</span>
<span class="w">                        </span><span class="n">nb_mom</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">)</span><span class="w">            </span><span class="c">!</span>

<span class="w">      </span><span class="n">tab</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">lg</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tab</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">lg</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">mx</span><span class="p">%</span><span class="n">mu</span>

<span class="w">      </span><span class="c">! sort in decreasing order</span>
<span class="w">      </span><span class="n">tab</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">lg</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">tab</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">lg</span><span class="p">)</span>
<span class="w">      </span><span class="k">call </span><span class="n">sort_array2</span><span class="p">(</span><span class="w"> </span><span class="n">tab_inout</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tab</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">lg</span><span class="p">),</span><span class="w">    </span><span class="p">&amp;</span><span class="w">  </span><span class="c">!</span>
<span class="w">                        </span><span class="n">n</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="n">lg</span><span class="w"> </span><span class="p">)</span><span class="w">             </span><span class="c">!</span>
<span class="w">      </span><span class="n">tab</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">lg</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">tab</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">lg</span><span class="p">)</span>

<span class="w">      </span><span class="c">! reduction factor to stay between 1 and 100 because there are</span>
<span class="w">      </span><span class="c">! too many points in array tab</span>
<span class="w">      </span><span class="n">reduction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nb_points</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">10</span><span class="mf">0.</span>

<span class="w">      </span><span class="c">! array of points for the curve</span>
<span class="w">      </span><span class="k">allocate</span><span class="p">(</span><span class="w"> </span><span class="n">tab_moy</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nb_points</span><span class="p">)</span><span class="w"> </span><span class="p">)</span>

<span class="w">      </span><span class="c">! nb heights of tab representing each point of the curve</span>
<span class="w">      </span><span class="n">nb_paquets</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lg</span><span class="o">/</span><span class="p">(</span><span class="w"> </span><span class="n">nb_points</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">)</span>
<span class="w">      </span><span class="c">! ... and remaining heights</span>
<span class="w">      </span><span class="n">reste</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="n">lg</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">nb_paquets</span><span class="o">*</span><span class="p">(</span><span class="w"> </span><span class="n">nb_points</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">)</span>

<span class="w">      </span><span class="c">! array of points; the first point and the last one are</span>
<span class="w">      </span><span class="c">! the first and last height to keep the extrema.</span>
<span class="w">      </span><span class="n">inc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
<span class="w">      </span><span class="k">do </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">nb_points</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span>

<span class="w">         </span><span class="n">tab_moy</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tab</span><span class="p">(</span><span class="n">inc</span><span class="p">)</span>
<span class="w">         </span><span class="n">inc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">inc</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">nb_paquets</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">nb_points</span><span class="o">/</span><span class="mi">2</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">inc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">inc</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">reste</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="c">! the remaing heights are added to</span>
<span class="w">                                                       </span><span class="c">! the middle points, where it makes less difference</span>
<span class="w">      </span><span class="k">enddo</span>
<span class="k">      </span><span class="n">tab_moy</span><span class="p">(</span><span class="n">nb_points</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tab</span><span class="p">(</span><span class="n">lg</span><span class="p">)</span>

<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">curves</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="c">! print histogram ?</span>

<span class="w">         </span><span class="n">ncat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">100</span><span class="w">                                      </span><span class="c">!  nombre de &quot;classes&quot; pour l&#39;histogramme</span>
<span class="w">         </span><span class="k">allocate</span><span class="p">(</span><span class="w"> </span><span class="n">tab_abbott</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">ncat</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="n">tab_abbott</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">ncat</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>

<span class="w">         </span><span class="n">hmin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tab</span><span class="p">(</span><span class="n">lg</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">100</span><span class="o">*</span><span class="n">EPS_R8</span><span class="w">                     </span><span class="c">!  pour être sûr d&#39;attraper le min</span>
<span class="w">         </span><span class="n">hmax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tab</span><span class="p">(</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">100</span><span class="o">*</span><span class="n">EPS_R8</span><span class="w">                     </span><span class="c">!  idem pour le max</span>

<span class="w">         </span><span class="n">delt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">hmax</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">hmin</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">ncat</span><span class="w">                   </span><span class="c">! categories width (heights)</span>

<span class="w">         </span><span class="n">seuil</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">hmax</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">delt</span>

<span class="w">         </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">         </span><span class="k">do </span><span class="n">icat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">ncat</span>

<span class="w">            </span><span class="k">do</span>
<span class="k">               </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">lg</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">exit</span>
<span class="k">               if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">tab</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">seuil</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">exit</span>
<span class="k">               </span><span class="n">tab_abbott</span><span class="p">(</span><span class="n">icat</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tab_abbott</span><span class="p">(</span><span class="n">icat</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
<span class="w">            </span><span class="k">enddo</span>

<span class="k">            </span><span class="n">seuil</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">seuil</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">delt</span>

<span class="w">         </span><span class="k">enddo</span>

<span class="k">         call </span><span class="n">get_unit</span><span class="p">(</span><span class="w"> </span><span class="n">ua</span><span class="w"> </span><span class="p">)</span>
<span class="w">         </span><span class="k">open</span><span class="p">(</span><span class="w"> </span><span class="n">unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ua</span><span class="p">,</span><span class="w"> </span><span class="k">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">trim</span><span class="p">(</span><span class="n">nom</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39;_histo.txt&#39;</span><span class="p">)</span>

<span class="w">            </span><span class="k">do </span><span class="n">icat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">ncat</span>

<span class="w">               </span><span class="k">write</span><span class="p">(</span><span class="n">ua</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="kt">real</span><span class="p">(</span><span class="w"> </span><span class="n">hmax</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">delt</span><span class="o">/</span><span class="mi">2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">icat</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">delt</span><span class="p">,</span><span class="w"> </span><span class="nb">kind</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">R4</span><span class="w"> </span><span class="p">),</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="kt">real</span><span class="p">(</span><span class="w"> </span><span class="n">tab_abbott</span><span class="p">(</span><span class="n">icat</span><span class="p">),</span><span class="w"> </span><span class="nb">kind</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">R4</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">lg</span>

<span class="w">            </span><span class="k">enddo</span>

<span class="k">         close</span><span class="p">(</span><span class="n">ua</span><span class="p">)</span>

<span class="w">         </span><span class="k">deallocate</span><span class="p">(</span><span class="w"> </span><span class="n">tab_abbott</span><span class="w"> </span><span class="p">)</span>

<span class="w">      </span><span class="k">endif</span>

<span class="w">      </span><span class="c">! nb points for the line regression! between 30% and 60% of the curve</span>
<span class="w">      </span><span class="n">len_reg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">int</span><span class="p">(</span><span class="w"> </span><span class="mf">0.4</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">nb_points</span><span class="w"> </span><span class="p">)</span>
<span class="w">      </span><span class="n">beg_reg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">int</span><span class="p">(</span><span class="w"> </span><span class="mf">0.3</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">nb_points</span><span class="w"> </span><span class="p">)</span>
<span class="w">      </span><span class="n">end_reg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">beg_reg</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">len_reg</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span>

<span class="w">      </span><span class="k">allocate</span><span class="p">(</span><span class="w"> </span><span class="n">jac_reg</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">len_reg</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="p">)</span>

<span class="w">      </span><span class="c">! jacobian regression : vec_reg(1) * Xi + vec_reg(2) * 1</span>
<span class="w">      </span><span class="n">jac_reg</span><span class="p">(</span><span class="w"> </span><span class="mi">1</span><span class="p">:</span><span class="n">len_reg</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">beg_reg</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">len_reg</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">]</span>
<span class="w">      </span><span class="n">jac_reg</span><span class="p">(</span><span class="w"> </span><span class="mi">1</span><span class="p">:</span><span class="n">len_reg</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1._R8</span>

<span class="w">      </span><span class="k">call </span><span class="n">moindres_carres_lineaire</span><span class="p">(</span><span class="w">   </span><span class="n">nb_var</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">                            </span><span class="p">&amp;</span><span class="w">  </span><span class="c">! number of parameters to be determined</span>
<span class="w">                                       </span><span class="n">nb_pts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">len_reg</span><span class="p">,</span><span class="w">                      </span><span class="p">&amp;</span><span class="w">  </span><span class="c">! number of points for function evaluation</span>
<span class="w">                                       </span><span class="n">hij</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">tab_moy</span><span class="p">(</span><span class="w"> </span><span class="n">beg_reg</span><span class="p">:</span><span class="n">end_reg</span><span class="w"> </span><span class="p">),</span><span class="w">   </span><span class="p">&amp;</span><span class="w">  </span><span class="c">! vector of evaluation points (1:nb_pts)</span>
<span class="w">                                       </span><span class="n">beta</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">vec_reg</span><span class="p">(</span><span class="w"> </span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="w"> </span><span class="p">),</span><span class="w">               </span><span class="p">&amp;</span><span class="w">  </span><span class="c">! parameters vector (1:nb_var)</span>
<span class="w">                                       </span><span class="n">Jf</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">jac_reg</span><span class="p">(</span><span class="w"> </span><span class="mi">1</span><span class="p">:</span><span class="n">len_reg</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w">      </span><span class="c">! Jacobian (1:nb_pts, 1:nb_var)</span>

<span class="w">      </span><span class="c">! f(smrk1) coordinates</span>
<span class="w">      </span><span class="n">off1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vec_reg</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w">                               </span><span class="c">! (0._R8, off1)</span>
<span class="w">      </span><span class="k">do </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">nb_points</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">tab_moy</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">off1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">exit</span>
<span class="k">      enddo</span>
<span class="k">      </span><span class="n">smrk1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="w">                                       </span><span class="c">! (UN*smrk1, off1)</span>

<span class="w">      </span><span class="n">tmp</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="mf">0.</span>
<span class="w">      </span><span class="k">do </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">smrk1</span>
<span class="w">         </span><span class="n">tmp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tmp</span><span class="w"> </span><span class="o">+</span><span class="p">(</span><span class="w"> </span><span class="n">tab_moy</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">off1</span><span class="w"> </span><span class="p">)</span>
<span class="w">      </span><span class="k">enddo</span>
<span class="k">      </span><span class="n">spk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="o">*</span><span class="n">tmp</span><span class="o">/</span><span class="n">smrk1</span><span class="w">                               </span><span class="c">! areas equivalency</span>
<span class="w">      </span><span class="n">spk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">abs</span><span class="p">(</span><span class="n">spk</span><span class="p">)</span>

<span class="w">      </span><span class="c">! f(smrk2) coordinates</span>
<span class="w">      </span><span class="n">off2</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">vec_reg</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">nb_points</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">vec_reg</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w">     </span><span class="c">! (nb_points, off2)</span>
<span class="w">      </span><span class="k">do </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nb_points</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">tab_moy</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">off2</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">exit</span>
<span class="k">      enddo</span>
<span class="k">      </span><span class="n">smrk2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="w">                                       </span><span class="c">! (UN*smrk2, off2)</span>

<span class="w">      </span><span class="n">tmp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.</span>
<span class="w">      </span><span class="k">do </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">smrk2</span><span class="p">,</span><span class="w"> </span><span class="n">nb_points</span>
<span class="w">         </span><span class="n">tmp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tmp</span><span class="w"> </span><span class="o">+</span><span class="p">(</span><span class="w"> </span><span class="n">tab_moy</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">off2</span><span class="w"> </span><span class="p">)</span>
<span class="w">      </span><span class="k">enddo</span>
<span class="k">      </span><span class="n">svk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="o">*</span><span class="n">tmp</span><span class="o">/</span><span class="p">(</span><span class="w"> </span><span class="n">nb_points</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">smrk2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w">           </span><span class="c">! areas equivalency</span>

<span class="w">      </span><span class="n">sk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tab_moy</span><span class="p">(</span><span class="n">smrk1</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">tab_moy</span><span class="p">(</span><span class="n">smrk2</span><span class="p">)</span>

<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">curves</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="c">! print Abbott ?</span>
<span class="w">         </span><span class="k">call </span><span class="n">get_unit</span><span class="p">(</span><span class="w"> </span><span class="n">ua</span><span class="w"> </span><span class="p">)</span>

<span class="w">         </span><span class="k">open</span><span class="p">(</span><span class="n">unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ua</span><span class="p">,</span><span class="w"> </span><span class="k">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">trim</span><span class="p">(</span><span class="n">nom</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39;.dat&#39;</span><span class="p">)</span>

<span class="w">            </span><span class="k">do </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">nb_points</span>
<span class="w">               </span><span class="k">write</span><span class="p">(</span><span class="n">ua</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="kt">real</span><span class="p">(</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nb">kind</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">R4</span><span class="w"> </span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="w"> </span><span class="n">nb_points</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">),</span><span class="w">        </span><span class="p">&amp;</span><span class="w">  </span><span class="c">!</span>
<span class="w">                                  </span><span class="kt">real</span><span class="p">(</span><span class="w"> </span><span class="n">tab_moy</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="w"> </span><span class="nb">kind</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">R4</span><span class="p">),</span><span class="w">                     </span><span class="p">&amp;</span><span class="w">  </span><span class="c">!</span>
<span class="w">                                  </span><span class="kt">real</span><span class="p">(</span><span class="w"> </span><span class="n">vec_reg</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">vec_reg</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="w"> </span><span class="nb">kind</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">R4</span><span class="w"> </span><span class="p">)</span><span class="w">       </span><span class="c">!</span>
<span class="w">            </span><span class="k">enddo</span>

<span class="k">         close</span><span class="p">(</span><span class="n">ua</span><span class="p">)</span>

<span class="w">         </span><span class="k">open</span><span class="p">(</span><span class="n">unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ua</span><span class="p">,</span><span class="w"> </span><span class="k">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">trim</span><span class="p">(</span><span class="n">nom</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39;.gpl&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;replace&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">iostat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ios</span><span class="w"> </span><span class="p">)</span>

<span class="w">            </span><span class="k">write</span><span class="p">(</span><span class="w"> </span><span class="n">ua</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(a)&#39;</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;set terminal svg dashed size 350,262 font &quot;Verdana, 10&quot;&#39;</span>
<span class="w">            </span><span class="k">write</span><span class="p">(</span><span class="w"> </span><span class="n">ua</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(a)&#39;</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;set output &quot;&#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">nom</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39;.svg&quot;&#39;</span>
<span class="w">            </span><span class="k">write</span><span class="p">(</span><span class="w"> </span><span class="n">ua</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(a)&#39;</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;set title &quot;Abbott&quot;&#39;</span>
<span class="w">            </span><span class="k">write</span><span class="p">(</span><span class="w"> </span><span class="n">ua</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(a)&#39;</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;set xlabel &quot;%age&quot;&#39;</span>
<span class="w">            </span><span class="k">write</span><span class="p">(</span><span class="w"> </span><span class="n">ua</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(a)&#39;</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;set ylabel &quot;h&quot;&#39;</span>
<span class="w">            </span><span class="k">write</span><span class="p">(</span><span class="w"> </span><span class="n">ua</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(a)&#39;</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="s2">&quot;set style line 1 lc rgb &#39;dark-green&#39; lt 1 lw 1&quot;</span>
<span class="w">            </span><span class="k">write</span><span class="p">(</span><span class="w"> </span><span class="n">ua</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(a)&#39;</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="s2">&quot;set style line 2 lc rgb &#39;dark-green&#39; lt 5 lw 1&quot;</span>
<span class="w">            </span><span class="c">! tracé du segment horizontal de A1 (cf norme 25178)</span>
<span class="w">            </span><span class="k">write</span><span class="p">(</span><span class="w"> </span><span class="n">ua</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;set arrow 1 from &#39;</span><span class="p">,</span><span class="w">        </span><span class="mf">0._R8</span><span class="o">/</span><span class="n">reduction</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">off1</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39; to &#39;</span><span class="p">,</span><span class="w">     </span><span class="n">UN</span><span class="o">*</span><span class="n">smrk1</span><span class="o">/</span><span class="n">reduction</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="w">      </span><span class="n">off1</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39; nohead front ls 1&#39;</span>
<span class="w">            </span><span class="c">! tracé du segment incliné de A1</span>
<span class="w">            </span><span class="k">write</span><span class="p">(</span><span class="w"> </span><span class="n">ua</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;set arrow 2 from &#39;</span><span class="p">,</span><span class="w">     </span><span class="n">UN</span><span class="o">*</span><span class="n">smrk1</span><span class="o">/</span><span class="n">reduction</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">off1</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39; to &#39;</span><span class="p">,</span><span class="w">        </span><span class="mf">0._R8</span><span class="o">/</span><span class="n">reduction</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">spk</span><span class="w"> </span><span class="o">+</span><span class="n">off1</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39; nohead front ls 1&#39;</span>
<span class="w">            </span><span class="c">! tracé de la droite haute horizontale</span>
<span class="w">            </span><span class="k">write</span><span class="p">(</span><span class="w"> </span><span class="n">ua</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;set arrow 5 from &#39;</span><span class="p">,</span><span class="w">        </span><span class="mf">0._R8</span><span class="o">/</span><span class="n">reduction</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">off1</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39; to &#39;</span><span class="p">,</span><span class="w"> </span><span class="n">UN</span><span class="o">*</span><span class="n">nb_points</span><span class="o">/</span><span class="n">reduction</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="w">      </span><span class="n">off1</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39; nohead front ls 2&#39;</span>
<span class="w">            </span><span class="c">! tracé du segment horizontal de A2 (cf norme 25178)</span>
<span class="w">            </span><span class="k">write</span><span class="p">(</span><span class="w"> </span><span class="n">ua</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;set arrow 3 from &#39;</span><span class="p">,</span><span class="w">     </span><span class="n">UN</span><span class="o">*</span><span class="n">smrk2</span><span class="o">/</span><span class="n">reduction</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">off2</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39; to &#39;</span><span class="p">,</span><span class="w"> </span><span class="n">UN</span><span class="o">*</span><span class="n">nb_points</span><span class="o">/</span><span class="n">reduction</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="w">      </span><span class="n">off2</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39; nohead front ls 1&#39;</span>
<span class="w">            </span><span class="c">! tracé du segment incliné de A2</span>
<span class="w">            </span><span class="k">write</span><span class="p">(</span><span class="w"> </span><span class="n">ua</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;set arrow 4 from &#39;</span><span class="p">,</span><span class="w">     </span><span class="n">UN</span><span class="o">*</span><span class="n">smrk2</span><span class="o">/</span><span class="n">reduction</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">off2</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39; to &#39;</span><span class="p">,</span><span class="w"> </span><span class="n">UN</span><span class="o">*</span><span class="n">nb_points</span><span class="o">/</span><span class="n">reduction</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">svk</span><span class="w"> </span><span class="o">+</span><span class="n">off2</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39; nohead front ls 1&#39;</span>
<span class="w">            </span><span class="c">! tracé de la droite basse horizontale</span>
<span class="w">            </span><span class="k">write</span><span class="p">(</span><span class="w"> </span><span class="n">ua</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;set arrow 6 from &#39;</span><span class="p">,</span><span class="w"> </span><span class="n">UN</span><span class="o">*</span><span class="n">nb_points</span><span class="o">/</span><span class="n">reduction</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">off2</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39; to &#39;</span><span class="p">,</span><span class="w">        </span><span class="mf">0._R8</span><span class="o">/</span><span class="n">reduction</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="w">      </span><span class="n">off2</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39; nohead front ls 2&#39;</span>
<span class="w">            </span><span class="c">! tracé du segment vertical correspondant à sk</span>
<span class="w">            </span><span class="k">write</span><span class="p">(</span><span class="w"> </span><span class="n">ua</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;set arrow 7 from &#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">off2</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39; to &#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">off2</span><span class="w"> </span><span class="o">+</span><span class="n">sk</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39; nohead front ls 1&#39;</span>
<span class="w">            </span><span class="k">write</span><span class="p">(</span><span class="w"> </span><span class="n">ua</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(a)&#39;</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;plot &quot;&#39;</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="nb">trim</span><span class="p">(</span><span class="n">nom</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39;.dat&quot; &#39;</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="s1">&#39;using 1:2  title &quot;Abbott-Firestone curve&quot; with lines,\&#39;</span>
<span class="s1">            write( ua, &#39;</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="s1">&#39; )     &#39;</span><span class="w"> </span><span class="s2">&quot;&#39; // trim(nom)//&#39;.dat&quot;</span><span class="w"> </span><span class="s1">&#39; // &#39;</span><span class="n">using</span><span class="w"> </span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="w">  </span><span class="n">notitle</span><span class="w">                        </span><span class="n">with</span><span class="w"> </span><span class="n">lines</span><span class="w"> </span><span class="n">ls</span><span class="w"> </span><span class="mi">1</span><span class="s1">&#39;</span>

<span class="s1">         close(unit = ua)</span>

<span class="s1">         call run_gnuplot (trim(nom)//&#39;</span><span class="p">.</span><span class="n">gpl</span><span class="s1">&#39;)</span>
<span class="s1">      endif</span>

<span class="s1">      deallocate( jac_reg )</span>

<span class="s1">      !-----------------------------------------------------------</span>

<span class="s1">      call sort_array2( tab_inout = tab_moy(1:nb_points), &amp;  !</span>
<span class="s1">                        n         = nb_points )              !</span>

<span class="s1">      xx(1:4) = 0.0_R8 ! vector of parameters</span>
<span class="s1">      xl(1:4) = 0.0_R8 ! lower bound</span>
<span class="s1">      xu(1:4) = 1.0_R8 ! upper bound</span>

<span class="s1">      !initialize the class:</span>
<span class="s1">      call p%init(           n = 4,                   &amp;  ! IN           ; the parameter space dimension, i.e., the number of</span>
<span class="s1">                                                         !                adjustable parameters (size of the x vector).</span>
<span class="s1">                            xl = xl,                  &amp;  ! IN, DIM(n)   ; vector of lower bounds for x</span>
<span class="s1">                            xu = xu,                  &amp;  ! IN, DIM(n)   ; vector of upper bounds for x</span>
<span class="s1">                             f = cost,                &amp;  !              ; user-supplied scalar function of n variables, which</span>
<span class="s1">                                                         !                must have the pikaia_func procedure interface.</span>
<span class="s1">                        status = status,              &amp;  ! OUT          ; status output flag (0 if there were no errors)</span>
<span class="s1">                            np = 100,                 &amp;  ! IN, OPT      ; number of individuals in a population (default is 100)</span>
<span class="s1">                          ngen = 1000,                &amp;  ! IN, OPT      ; maximum number of iterations</span>
<span class="s1">                            nd = 9,                   &amp;  ! IN           ; number of significant digits (i.e., number of genes)</span>
<span class="s1">                                                         !                retained in chromosomal encoding</span>
<span class="s1">                        pcross = 0.85_R8,             &amp;  ! IN, OPT      ; crossover probability; must be &lt;= 1.0 (default is 0.85)</span>
<span class="s1">                                                         !                If crossover takes place, either one or two splicing points are used,</span>
<span class="s1">                                                         !                with equal probabilities</span>
<span class="s1">                        pmutmn = 0.0005_R8,           &amp;  ! IN, OPT      ; minimum mutation rate; must be &gt;= 0.0 (default is 0.0005)</span>
<span class="s1">                        pmutmx = 0.25_R8,             &amp;  ! IN, OPT      ; maximum mutation rate; must be &lt;= 1.0 (default is 0.25)</span>
<span class="s1">                          pmut = 0.005_R8,            &amp;  ! IN, OPT      ; initial mutation rate; should be small (default is 0.005)</span>
<span class="s1">                                                         !                (Note: the mutation rate is the probability that any one gene</span>
<span class="s1">                                                         !                 locus will mutate in any one generation.)</span>
<span class="s1">                          imut = 2,                   &amp;  ! IN, OPT      ; mutation mode; 1/2/3/4/5 (default is 2).</span>
<span class="s1">                                                         !                1=one-point mutation, fixed rate.</span>
<span class="s1">                                                         !                2=one-point, adjustable rate based on fitness.</span>
<span class="s1">                                                         !                3=one-point, adjustable rate based on distance.</span>
<span class="s1">                                                         !                4=one-point+creep, fixed rate.</span>
<span class="s1">                                                         !                5=one-point+creep, adjustable rate based on fitness.</span>
<span class="s1">                                                         !                6=one-point+creep, adjustable rate based on distance.</span>
<span class="s1">                          fdif = 1._R8,               &amp;  ! IN, OPT      ; relative fitness differential; range from 0 (none) to 1 (maximum).</span>
<span class="s1">                                                         !                (default is 1.0)</span>
<span class="s1">                          irep = 3,                   &amp;  ! IN, OPT      ; reproduction plan; 1/2/3=Full generational replacement/</span>
<span class="s1">                                                         !                                         Steady-state-replace-random/</span>
<span class="s1">                                                         !                                         Steady- state-replace-worst (default is 3)</span>
<span class="s1">                        ielite = 0,                   &amp;  ! IN, OPT      ; elitism flag; 0/1=off/on (default is 0)</span>
<span class="s1">                                                         !                (Applies only to reproduction plans 1 and 2)</span>
<span class="s1">                          ivrb = 0,                   &amp;  ! IN, OPT      ; printed output 0/1/2=None/Minimal/Verbose</span>
<span class="s1">               convergence_tol = 1.0e-6_R8,           &amp;  ! IN, OPT      ; convergence tolerance; must be &gt; 0.0 (default is 0.0001)</span>
<span class="s1">            convergence_window = 400,                 &amp;  ! IN, OPT      ; convergence window; must be &gt;= 0 This is the number of consecutive</span>
<span class="s1">                                                         !                solutions within the tolerance for convergence to be declared (default is 20)</span>
<span class="s1">            initial_guess_frac = 0.1_R8,              &amp;  ! IN, OPT      ; raction of the initial population to set equal to the initial guess.</span>
<span class="s1">                                                         !                Range from 0 (none) to 1.0 (all). (default is 0.1 or 10%).</span>
<span class="s1">                         iseed = 999)                    ! IN, OPT      ; random seed value; must be &gt; 0 (default is 999)</span>

<span class="s1">      !Now call pikaia:</span>
<span class="s1">      call p%solve(      x = xx(1:4),     &amp;  ! INOUT, DIM(*) ;</span>
<span class="s1">                         f = f,           &amp;  !   OUT         ;</span>
<span class="s1">                    status = status,      &amp;  !   OUT         ;</span>
<span class="s1">                       omp = omp )           ! IN</span>

<span class="s1">      xx(3:4) = xx(3:4) * mx%si</span>

<span class="s1">      if ( curves(3) ) then ! print tangent fit ?</span>

<span class="s1">         call get_unit(ua)</span>

<span class="s1">         open( unit = ua, file = trim(nom)//&#39;</span><span class="err">_</span><span class="n">tan</span><span class="p">.</span><span class="n">datt</span><span class="s1">&#39;)</span>

<span class="s1">            do i = 1, nb_points</span>

<span class="s1">               write(ua, *) 100 * real( i - 1, kind = R4) / (nb_points - 1),                                      &amp;  !</span>
<span class="s1">                                  real( tab_moy(i), kind = R4 ),                                                  &amp;  !</span>
<span class="s1">                                  real( tg( real( i - 1, kind = R8) / ( nb_points - 1 ), xx(1:4) ), kind = R4 )      !</span>

<span class="s1">            enddo</span>

<span class="s1">         close(ua)</span>

<span class="s1">         open( unit = ua, file = trim(nom)//&#39;</span><span class="err">_</span><span class="n">tan</span><span class="p">.</span><span class="n">gplt</span><span class="s1">&#39;, status = &#39;</span><span class="n">replace</span><span class="s1">&#39;, iostat = ios )</span>

<span class="s1">            write( ua, &#39;</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="s1">&#39; ) &#39;</span><span class="n">set</span><span class="w"> </span><span class="n">terminal</span><span class="w"> </span><span class="n">svg</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="mi">350</span><span class="p">,</span><span class="mi">262</span><span class="w"> </span><span class="n">font</span><span class="w"> </span><span class="s2">&quot;Verdana, 10&quot;</span><span class="s1">&#39;</span>
<span class="s1">            write( ua, &#39;</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="s1">&#39; ) &#39;</span><span class="n">set</span><span class="w"> </span><span class="n">output</span><span class="w"> </span><span class="s2">&quot;&#39;//trim(nom)//&#39;_tan.svgt&quot;</span><span class="s1">&#39;</span>
<span class="s1">            write( ua, &#39;</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="s1">&#39; ) &#39;</span><span class="n">set</span><span class="w"> </span><span class="n">title</span><span class="w"> </span><span class="s2">&quot;Abbott-Firestone curve&quot;</span><span class="s1">&#39;</span>
<span class="s1">            write( ua, &#39;</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="s1">&#39; ) &#39;</span><span class="n">set</span><span class="w"> </span><span class="n">xlabel</span><span class="w"> </span><span class="s2">&quot;%age&quot;</span><span class="s1">&#39;</span>
<span class="s1">            write( ua, &#39;</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="s1">&#39; ) &#39;</span><span class="n">set</span><span class="w"> </span><span class="n">ylabel</span><span class="w"> </span><span class="s2">&quot;h&quot;</span><span class="s1">&#39;</span>
<span class="s1">            write( ua, &#39;</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="s1">&#39; ) &#39;</span><span class="n">plot</span><span class="w"> </span><span class="s2">&quot;&#39; // trim(nom)//&#39;_tan.datt&quot;</span><span class="w"> </span><span class="s1">&#39; // &#39;</span><span class="n">using</span><span class="w"> </span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="w">  </span><span class="n">title</span><span class="w"> </span><span class="s2">&quot;Abbott-Firestone&quot;</span><span class="w">   </span><span class="n">with</span><span class="w"> </span><span class="n">lines</span><span class="p">,</span><span class="err">\</span><span class="s1">&#39;</span>
<span class="s1">            write( ua, &#39;</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="s1">&#39; )     &#39;</span><span class="w"> </span><span class="s2">&quot;&#39; // trim(nom)//&#39;_tan.datt&quot;</span><span class="w"> </span><span class="s1">&#39; // &#39;</span><span class="n">using</span><span class="w"> </span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="w">  </span><span class="n">title</span><span class="w"> </span><span class="s2">&quot;tangent regression&quot;</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">lines</span><span class="s1">&#39;</span>

<span class="s1">         close(unit = ua)</span>

<span class="s1">         call run_gnuplot (trim(nom)//&#39;</span><span class="err">_</span><span class="n">tan</span><span class="p">.</span><span class="n">gplt</span><span class="err">&#39;</span><span class="p">)</span>

<span class="w">      </span><span class="k">endif</span>

<span class="k">      </span><span class="n">results</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">11</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="kt">real</span><span class="p">(</span><span class="n">smrk1</span><span class="p">,</span><span class="w"> </span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="o">/</span><span class="n">nb_points</span><span class="p">,</span><span class="w">  </span><span class="p">&amp;</span><span class="w"> </span><span class="c">!  1 smrk1, iso 25178</span>
<span class="w">                        </span><span class="kt">real</span><span class="p">(</span><span class="n">smrk2</span><span class="p">,</span><span class="w"> </span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="o">/</span><span class="n">nb_points</span><span class="p">,</span><span class="w">  </span><span class="p">&amp;</span><span class="w"> </span><span class="c">!  2 smrk2, iso 25178</span>
<span class="w">                        </span><span class="n">spk</span><span class="p">,</span><span class="w">                                 </span><span class="p">&amp;</span><span class="w"> </span><span class="c">!  3 spk , iso 25178</span>
<span class="w">                        </span><span class="nb">abs</span><span class="p">(</span><span class="n">svk</span><span class="p">),</span><span class="w">                            </span><span class="p">&amp;</span><span class="w"> </span><span class="c">!  4 svk , iso 25178</span>
<span class="w">                        </span><span class="n">spk</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">off1</span><span class="p">,</span><span class="w">                          </span><span class="p">&amp;</span><span class="w"> </span><span class="c">!  5 off1, ordonnée de spk</span>
<span class="w">                        </span><span class="nb">abs</span><span class="p">(</span><span class="n">svk</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">off2</span><span class="p">),</span><span class="w">                     </span><span class="p">&amp;</span><span class="w"> </span><span class="c">!  6 off2, ordonnée de svk</span>
<span class="w">                        </span><span class="n">sk</span><span class="p">,</span><span class="w">                                  </span><span class="p">&amp;</span><span class="w"> </span><span class="c">!  7 sk  , iso 25178</span>
<span class="w">                        </span><span class="n">vec_reg</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">nb_points</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">10</span><span class="mf">0.</span><span class="p">,</span><span class="w">       </span><span class="p">&amp;</span><span class="w"> </span><span class="c">!  8 core slope</span>
<span class="w">                        </span><span class="n">f</span><span class="p">,</span><span class="w">                                   </span><span class="p">&amp;</span><span class="w"> </span><span class="c">!  9 adjustment factor (tangent fit)</span>
<span class="w">                        </span><span class="n">xx</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="w">                               </span><span class="p">&amp;</span><span class="w"> </span><span class="c">! 10 coeffa_tan        (tangent fit)</span>
<span class="w">                        </span><span class="n">xx</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="p">]</span><span class="w">                                </span><span class="c">! 11 coeffb_tan        (tangent fit)</span>

<span class="w">      </span><span class="k">deallocate</span><span class="p">(</span><span class="w"> </span><span class="n">tab_moy</span><span class="w"> </span><span class="p">)</span>

<span class="w">      </span><span class="k">contains</span>

<span class="k">      subroutine </span><span class="n">cost</span><span class="p">(</span><span class="n">me</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">f</span><span class="p">)</span>
<span class="w">      </span><span class="k">implicit none</span>
<span class="k">      class</span><span class="p">(</span><span class="n">pikaia_class</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w">               </span><span class="kd">::</span><span class="w"> </span><span class="n">me</span>
<span class="w">      </span><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">)</span><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="w">   </span><span class="p">),</span><span class="w"> </span><span class="k">dimension</span><span class="p">(:)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">x</span>
<span class="w">      </span><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">)</span><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="w">  </span><span class="n">out</span><span class="p">)</span><span class="w">               </span><span class="kd">::</span><span class="w"> </span><span class="n">f</span>

<span class="w">         </span><span class="n">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.</span><span class="o">/</span><span class="p">(</span><span class="mf">1.</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">diff_abb_tan</span><span class="p">(</span><span class="n">chrom</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">)))</span>

<span class="w">      </span><span class="k">return</span>
<span class="k">      endsubroutine </span><span class="n">cost</span>

<span class="w">      </span><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">)</span><span class="w"> </span><span class="k">function </span><span class="n">diff_abb_tan</span><span class="p">(</span><span class="n">chrom</span><span class="p">)</span>
<span class="w">      </span><span class="k">implicit none</span>
<span class="k">      </span><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="w"> </span><span class="k">dimension</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">chrom</span>

<span class="w">         </span><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">I4</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">i</span>

<span class="w">         </span><span class="c">! the height array is standardize to avoid too small values</span>
<span class="w">         </span><span class="n">diff_abb_tan</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">sum</span><span class="p">(</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">tg</span><span class="p">(</span><span class="w"> </span><span class="kt">real</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nb">kind</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">R8</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">nb_points</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="n">chrom</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">tab_moy</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">mx</span><span class="p">%</span><span class="n">si</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">**</span><span class="w"> </span><span class="mf">2.</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">nb_points</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">)</span>

<span class="w">      </span><span class="k">return</span>
<span class="k">      endfunction </span><span class="n">diff_abb_tan</span>

<span class="w">      </span><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">)</span><span class="w"> </span><span class="k">function </span><span class="n">tg</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span><span class="w"> </span><span class="n">chrom</span><span class="p">)</span>
<span class="w">      </span><span class="k">implicit none</span>
<span class="k">      </span><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w">                 </span><span class="kd">::</span><span class="w"> </span><span class="n">xi</span>
<span class="w">      </span><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">R8</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="w"> </span><span class="k">dimension</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">chrom</span>

<span class="w">         </span><span class="n">tg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chrom</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nb">tan</span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">PI_R8</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="mf">1._R8</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">chrom</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">xi</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="mf">2._R8</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">chrom</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">chrom</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">chrom</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>

<span class="w">      </span><span class="k">return</span>
<span class="k">      endfunction </span><span class="n">tg</span>


<span class="w">   </span><span class="k">endsubroutine </span><span class="n">abbott_param</span>
</pre></div>

    </section>
    <br>
    
    </div>
  </div>

      <hr>
    </div> <!-- /container -->
    <footer>
      <div class="container">
        <div class="row justify-content-between">
          <div class="col">
            <p>
              TPGLIB
 was developed by Arthur Francisco<br>              &copy; 2024 
</p>
          </div>
          <div class="col">
            <p class="text-end">
              Documentation generated by
              <a href="https://github.com/Fortran-FOSS-Programmers/ford">FORD</a>
 on 2024-12-18 17:14              </p>
          </div>
        </div>
        <br>
      </div> <!-- /container -->
    </footer>

    <!-- Bootstrap core JavaScript -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>    

    <!-- MathJax JavaScript
             ================================================== -->
             <!-- Placed at the end of the document so the pages load faster -->
        <script type="text/x-mathjax-config">
          MathJax.Hub.Config({
          TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } },
          jax: ['input/TeX','input/MathML','output/HTML-CSS'],
          extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']
          });
        </script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

          <script src="../tipuesearch/tipuesearch_content.js"></script>
          <script src="../tipuesearch/tipuesearch_set.js"></script>
          <script src="../tipuesearch/tipuesearch.js"></script>

  </body>
</html>